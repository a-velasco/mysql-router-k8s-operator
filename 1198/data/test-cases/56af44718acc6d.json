{"uid":"56af44718acc6d","name":"test_log_rotation","fullName":"tests.integration.test_log_rotation#test_log_rotation","historyId":"cee6faeba82de98eaf891ec9dd9520e1","time":{"start":1710293420616,"stop":1710293517598,"duration":96982},"description":"Test log rotation.","descriptionHtml":"<p>Test log rotation.</p>\n","status":"broken","statusMessage":"subprocess.CalledProcessError: Command '['kubectl', 'exec', '-n', 'test', '-it', 'mysql-router-k8s-0', '--container', 'mysql-router', '--', 'su', '-', 'mysql', '-c', 'logrotate -f -s /tmp/logrotate.status /etc/logrotate.d/flush_mysqlrouter_logs']' returned non-zero exit status 1.","statusTrace":"Traceback (most recent call last):\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 493, in __call__\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 115, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 152, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 114, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 77, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 1788, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 493, in __call__\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 115, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 152, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 114, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 77, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pytest_asyncio/plugin.py\", line 532, in inner\n    _loop.run_until_complete(task)\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\n    return future.result()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/tests/integration/test_log_rotation.py\", line 131, in test_log_rotation\n    await rotate_mysqlrouter_logs(ops_test, unit.name)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/tests/integration/helpers.py\", line 334, in rotate_mysqlrouter_logs\n    subprocess.run(\n  File \"/usr/lib/python3.10/subprocess.py\", line 526, in run\n    raise CalledProcessError(retcode, process.args,\nsubprocess.CalledProcessError: Command '['kubectl', 'exec', '-n', 'test', '-it', 'mysql-router-k8s-0', '--container', 'mysql-router', '--', 'su', '-', 'mysql', '-c', 'logrotate -f -s /tmp/logrotate.status /etc/logrotate.d/flush_mysqlrouter_logs']' returned non-zero exit status 1.","flaky":false,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"event_loop","time":{"start":1710293420336,"stop":1710293420336,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test","time":{"start":1710293420337,"stop":1710293420615,"duration":278},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tmp_path_factory","time":{"start":1710293420337,"stop":1710293420337,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail","time":{"start":1710293420616,"stop":1710293420616,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Test log rotation.","status":"broken","statusMessage":"subprocess.CalledProcessError: Command '['kubectl', 'exec', '-n', 'test', '-it', 'mysql-router-k8s-0', '--container', 'mysql-router', '--', 'su', '-', 'mysql', '-c', 'logrotate -f -s /tmp/logrotate.status /etc/logrotate.d/flush_mysqlrouter_logs']' returned non-zero exit status 1.","statusTrace":"Traceback (most recent call last):\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 493, in __call__\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 115, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 152, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 114, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 77, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 1788, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 493, in __call__\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 115, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 152, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 114, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 77, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/.tox/integration/lib/python3.10/site-packages/pytest_asyncio/plugin.py\", line 532, in inner\n    _loop.run_until_complete(task)\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\n    return future.result()\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/tests/integration/test_log_rotation.py\", line 131, in test_log_rotation\n    await rotate_mysqlrouter_logs(ops_test, unit.name)\n  File \"/home/runner/work/mysql-router-k8s-operator/mysql-router-k8s-operator/tests/integration/helpers.py\", line 334, in rotate_mysqlrouter_logs\n    subprocess.run(\n  File \"/usr/lib/python3.10/subprocess.py\", line 526, in run\n    raise CalledProcessError(retcode, process.args,\nsubprocess.CalledProcessError: Command '['kubectl', 'exec', '-n', 'test', '-it', 'mysql-router-k8s-0', '--container', 'mysql-router', '--', 'su', '-', 'mysql', '-c', 'logrotate -f -s /tmp/logrotate.status /etc/logrotate.d/flush_mysqlrouter_logs']' returned non-zero exit status 1.","steps":[],"attachments":[{"uid":"3485818d070e99a1","name":"log","source":"3485818d070e99a1.txt","type":"text/plain","size":3638}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"abort_on_fail::0","time":{"start":1710293517632,"stop":1710293517632,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test::finalizer","time":{"start":1710293517633,"stop":1710293520468,"duration":2835},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::2","time":{"start":1710293520469,"stop":1710293520469,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_close_event_loop","time":{"start":1710293520470,"stop":1710293520470,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_provide_clean_event_loop","time":{"start":1710293520470,"stop":1710293520470,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"abort_on_fail"},{"name":"tag","value":"group(1)"},{"name":"tag","value":"asyncio"},{"name":"parentSuite","value":"tests.integration"},{"name":"suite","value":"test_log_rotation"},{"name":"host","value":"fv-az1530-811"},{"name":"thread","value":"12695-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.test_log_rotation"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":0,"broken":6,"skipped":0,"passed":34,"unknown":0,"total":40},"items":[{"uid":"33cc9a9af76bf9d7","reportUrl":"../1196//#testresult/33cc9a9af76bf9d7","status":"passed","time":{"start":1710206958170,"stop":1710207047352,"duration":89182}},{"uid":"18bc01893659d616","reportUrl":"../1194//#testresult/18bc01893659d616","status":"passed","time":{"start":1710120585606,"stop":1710120668778,"duration":83172}},{"uid":"5f0a5b7ffe3511a3","reportUrl":"../1193//#testresult/5f0a5b7ffe3511a3","status":"passed","time":{"start":1710034317282,"stop":1710034421206,"duration":103924}},{"uid":"e8701d8f175ed7d0","reportUrl":"../1192//#testresult/e8701d8f175ed7d0","status":"passed","time":{"start":1709947636640,"stop":1709947721674,"duration":85034}},{"uid":"1e77a96dda5c43d2","reportUrl":"../1190//#testresult/1e77a96dda5c43d2","status":"passed","time":{"start":1709861371428,"stop":1709861463595,"duration":92167}},{"uid":"75660a1626cea040","reportUrl":"../1186//#testresult/75660a1626cea040","status":"passed","time":{"start":1709774414613,"stop":1709774504773,"duration":90160}},{"uid":"4f840534e9937157","reportUrl":"../1167//#testresult/4f840534e9937157","status":"passed","time":{"start":1709083719904,"stop":1709083821917,"duration":102013}},{"uid":"9268d0e0b3261b24","reportUrl":"../1166//#testresult/9268d0e0b3261b24","status":"passed","time":{"start":1708997327829,"stop":1708997421006,"duration":93177}},{"uid":"1a35c3da791255b4","reportUrl":"../1161//#testresult/1a35c3da791255b4","status":"passed","time":{"start":1708911009594,"stop":1708911093842,"duration":84248}},{"uid":"2187fc18a95eaf8e","reportUrl":"../1160//#testresult/2187fc18a95eaf8e","status":"broken","statusDetails":"subprocess.CalledProcessError: Command '['kubectl', 'exec', '-n', 'test', '-it', 'mysql-router-k8s-0', '--container', 'mysql-router', '--', 'su', '-', 'mysql', '-c', 'logrotate -f -s /tmp/logrotate.status /etc/logrotate.d/flush_mysqlrouter_logs']' returned non-zero exit status 1.","time":{"start":1708824743724,"stop":1708824842064,"duration":98340}},{"uid":"7a9a6181b9b7206a","reportUrl":"../1159//#testresult/7a9a6181b9b7206a","status":"passed","time":{"start":1708738065359,"stop":1708738152683,"duration":87324}},{"uid":"d26a30573d71ff57","reportUrl":"../1157//#testresult/d26a30573d71ff57","status":"passed","time":{"start":1708651735524,"stop":1708651835971,"duration":100447}},{"uid":"5d8cbf7fed2bad97","reportUrl":"../1155//#testresult/5d8cbf7fed2bad97","status":"passed","time":{"start":1708565351920,"stop":1708565445082,"duration":93162}},{"uid":"a752dddd88dc8540","reportUrl":"../1154//#testresult/a752dddd88dc8540","status":"passed","time":{"start":1708478984789,"stop":1708479080367,"duration":95578}},{"uid":"3d5364bf33be1ace","reportUrl":"../1152//#testresult/3d5364bf33be1ace","status":"passed","time":{"start":1708392551646,"stop":1708392644460,"duration":92814}},{"uid":"5f3bf0eb8c978ca","reportUrl":"../1149//#testresult/5f3bf0eb8c978ca","status":"passed","time":{"start":1708306228090,"stop":1708306314148,"duration":86058}},{"uid":"8c847684bec3b1ae","reportUrl":"../1148//#testresult/8c847684bec3b1ae","status":"passed","time":{"start":1708219900131,"stop":1708220002333,"duration":102202}},{"uid":"6005e3f04ee107c6","reportUrl":"../1147//#testresult/6005e3f04ee107c6","status":"passed","time":{"start":1708133365074,"stop":1708133459744,"duration":94670}},{"uid":"f5c510907325b0ed","reportUrl":"../1146//#testresult/f5c510907325b0ed","status":"passed","time":{"start":1708046975392,"stop":1708047076305,"duration":100913}},{"uid":"327d768014eca590","reportUrl":"../1145//#testresult/327d768014eca590","status":"passed","time":{"start":1707960580706,"stop":1707960683999,"duration":103293}}]},"tags":["asyncio","abort_on_fail","group(1)"]},"source":"56af44718acc6d.json","parameterValues":[]}